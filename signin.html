<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in - SuccessApp</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="styles.css?v=20250827">
    <style>
    .signin-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    .signin-card { background: rgba(0,0,0,0.5); border: 1px solid #263141; border-radius: 16px; padding: 28px; width: 92%; max-width: 440px; text-align: center; color: #e5e7eb; backdrop-filter: blur(10px); }
    .signin-title { font-size: 1.6rem; margin-bottom: 8px; }
    .signin-sub { color: #94a3b8; margin-bottom: 18px; }
    .signin-actions { display: flex; gap: 10px; justify-content: center; }
    .hidden { display: none; }
    </style>
    <script>
      // Prevent cached version issues
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister()));
      }
    </script>
</head>
<body>
  <div class="signin-container">
    <div class="signin-card">
      <h1 class="signin-title">SuccessApp</h1>
      <p class="signin-sub">Sign in with Google to continue</p>
      <div id="signinMessage" class="signin-sub"></div>
      <div class="signin-actions">
        <button id="goSignIn" class="control-btn">Sign in with Google</button>
        <button id="goApp" class="control-btn hidden">Go to app</button>
      </div>
    </div>
  </div>

  <script src="firebase-config.js?v=20250827"></script>
  <script>
    (function(){
      const msg = document.getElementById('signinMessage');
      const goSignIn = document.getElementById('goSignIn');
      const goApp = document.getElementById('goApp');

      function toApp(){ window.location.href = 'index.html'; }

      if (typeof auth === 'undefined' || typeof googleProvider === 'undefined') {
        msg.textContent = 'Auth not initialized. Refresh the page.';
      } else {
        auth.getRedirectResult().catch(e => console.warn('[Auth] redirect result error', e));
        auth.onAuthStateChanged((user) => {
          if (user) {
            msg.textContent = '';
            goSignIn.classList.add('hidden');
            goApp.classList.remove('hidden');
          } else {
            msg.textContent = '';
            goSignIn.classList.remove('hidden');
            goApp.classList.add('hidden');
          }
        });

        goSignIn.addEventListener('click', async () => {
          try {
            await auth.signInWithRedirect(googleProvider);
          } catch (e) {
            msg.textContent = 'Sign-in failed. Check console and popup settings.';
            console.error(e);
          }
        });
        goApp.addEventListener('click', toApp);
      }
    })();
  </script>
</body>
</html>


